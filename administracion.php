<?phprequire_once "clases/AccesoDatos.php";require_once "clases/Usuario.php";$queMuestro = isset($_POST['queMuestro']) ? $_POST['queMuestro'] : NULL;switch ($queMuestro) {    case "2":        //LOGOUT		//IMPLEMENTAR...        session_start();        if (isset($_SESSION["Usuario"]))        {            session_unset();            echo "Ok";        }        else            echo "No Ok";        break;    case "3":        //MOSTRAR GRILLA		//IMPLEMENTAR...        require_once "grilla.php";        break;    case "4":        //MUESTRA FORM ALTA-MODIFICACION USUARIO		//IMPLEMENTAR...        require_once "form.php";        break;    case "5":        //SUBIR FOTO AL TMP		//IMPLEMENTAR...        require_once "clases/Archivo.php";        $resultado = new stdClass();        if (!isset($_FILES["imagenModificada"]))        {            $resultado->exito = FALSE;            $resultado->mensaje = "ERROR";            echo json_encode($resultado);        }        else        {            $resultado = Archivo::Subir();            echo json_encode($resultado);        }        break;    case "6":        //ALTA USUARIO		//IMPLEMENTAR...        require_once "clases/Archivo.php";        $resultado = new stdClass();        $resultado->exito = TRUE;        if (!isset($_POST["nuevoUsuario"]))        {            $resultado->exito = FALSE;            $resultado->mensaje = "ERROR";            echo json_encode($resultado);        }        else        {            $nuevoUsuario = json_decode($_POST["nuevoUsuario"]);            $origen = $_POST["fotoNueva"];            $destino = "fotos/" . $nuevoUsuario->foto;            $fotoNueva = substr_count($origen, "tmp/") > 0;            if (!$fotoNueva || Archivo::Mover($origen, $destino))            {                if (Usuario::Agregar($nuevoUsuario))                    $resultado->mensaje = "El usuario ha sido agregado.";                else                {                    $resultado->mensaje = "Ocurrio un error al agregar al usuario.";                    $resultado->exito = FALSE;                }            }            else            {                $resultado->mensaje = "Ocurrio un error al guardar la imagen.";                $resultado->exito = FALSE;               }            echo json_encode($resultado);        }        break;    case "7":        //ELIMINAR USUARIO		//IMPLEMENTAR...        require_once "clases/Archivo.php";        $resultado = new stdClass();        $resultado->exito = TRUE;        if (!isset($_POST["idEliminar"]) || !isset($_POST["fotoEliminar"]))        {            $resultado->exito = FALSE;            $resultado->mensaje = "ERROR";        }        else        {            // Agregar al JSON            $usuarioASerEliminado = new Usuario($_POST["idEliminar"]);            if (session_id() == '')                session_start();            if (isset($_SESSION["Usuario"]))            {                $usuarioEnSesion = json_decode($_SESSION["Usuario"]);                if ($usuarioEnSesion->id == $_POST["idEliminar"])                {                    $resultado->exito = FALSE;                    $resultado->mensaje = "No se puede eliminar a si mismo.";                }                else                {                    if (Usuario::Borrar($_POST["idEliminar"]))                    {                        if ($_POST["fotoEliminar"] != './fotos/pordefecto.jpg') //Evito eliminar la imagen por defecto.                            Archivo::Borrar($_POST["fotoEliminar"]);                        if (isset($_COOKIE["theme" . $_POST["idEliminar"]]))                            setcookie("theme" . $_POST["idEliminar"], " ", time() - 1);                        $resultado->mensaje = "Usuario eliminado.";                        //Agregar al JSON                        $objInformacion = new stdClass();                        $objInformacion->idEliminado = $usuarioASerEliminado->id;                        $objInformacion->nombreEliminado = $usuarioASerEliminado->nombre;                        $objInformacion->emailEliminado = $usuarioASerEliminado->email;                        $objInformacion->perfilEliminado = $usuarioASerEliminado->perfil;                        $objInformacion->idSesion = $usuarioEnSesion->id;                        $objInformacion->nombreSesion = $usuarioEnSesion->nombre;                        date_default_timezone_set("America/Argentina/Buenos_Aires");                        $objInformacion->fechaEliminacion = date('d-m-y H:i:s');                        Archivo::AgregarEliminadoJSON(json_encode($objInformacion));                    }                    else                    {                        $resultado->exito = FALSE;                        $resultado->mensaje = "Ha ocurrido un error al querer eliminar al usuario.";                    }                }            }        }        echo json_encode($resultado);        break;            case "8":        //MODIFICAR USUARIO		//IMPLEMENTAR...        require_once "clases/Archivo.php";        $resultado = new stdClass();        $resultado->exito = TRUE;        $resultado->usuarioEnSesionModificado = FALSE;        if (!isset($_POST["usuarioModificado"]))        {            $resultado->exito = FALSE;            $resultado->mensaje = "ERROR";            echo json_encode($resultado);        }        else        {            $usuarioModificado = json_decode($_POST["usuarioModificado"]);            $usuarioOriginal = new Usuario($usuarioModificado->id);            $origen = $_POST["fotoNueva"];            $destino = "fotos/" . $usuarioModificado->foto;            $fotoModificada = substr_count($origen, "tmp/") > 0;            if (!$fotoModificada || Archivo::Mover($origen, $destino))            {                if (Usuario::Modificar($usuarioModificado))                {                    $resultado->mensaje = "El usuario ha sido modificado.";                    if ($fotoModificada)                        if ($usuarioOriginal->foto != "pordefecto.jpg")                            Archivo::Borrar("fotos/" . $usuarioOriginal->foto);                    // Actualizar usuario en sesion si fue modificado.                    if (session_id() == '')                        session_start();                    if (isset($_SESSION["Usuario"]))                    {                        $usuarioEnSesion = json_decode($_SESSION["Usuario"]);                        if ($usuarioEnSesion->id == $usuarioModificado->id)                        {                            $_SESSION["Usuario"] = json_encode($usuarioModificado);                            $resultado->usuarioEnSesionModificado = TRUE;                            $resultado->usuarioEnSesionNombre = $usuarioModificado->nombre;                            $resultado->usuarioEnSesionPerfil = $usuarioModificado->perfil;                            $resultado->usuarioEnSesionFoto = $destino;                        }                    }                }                else                {                    $resultado->mensaje = "Ocurrio un error al modificar al usuario.";                    $resultado->exito = FALSE;                }            }            else            {                $resultado->mensaje = "Ocurrio un error al guardar la imagen.";                $resultado->exito = FALSE;               }            echo json_encode($resultado);        }        break;	case "9":        //ELEGIR THEME		//IMPLEMENTAR...        require_once "grillaTheme.php";		break;		case "10":        //GUARDA EN COOKIE EL THEME		//IMPLEMENTAR...        $resultado = new stdClass();        $resultado->exito = TRUE;        if (!isset($_POST["tema"]))        {            $resultado->exito = FALSE;            $resultado->mensaje = "ERROR";            echo json_encode($resultado);        }        else        {            if (session_id() == '')                session_start();            $tema = $_POST["tema"];            $usuarioEnSesion = json_decode($_SESSION["Usuario"]);            if (setcookie("theme" . $usuarioEnSesion->id, $tema, time() + 60*60*24*30))                $resultado->mensaje = "Se ha guardado el tema.";            else            {                $resultado->exito = FALSE;                $resultado->mensaje = "Ha ocurrido un error al querer guardar el tema.";            }            echo json_encode($resultado);        }		break;    case "11":      //Mostrar Grilla Eliminados.        require_once "clases/Archivo.php";        $eliminados = Archivo::TraerEliminadosJSON();        if ($eliminados === FALSE)            echo "ERROR";        else            echo Archivo::MostrarGrilla(json_decode($eliminados));                break;		    default:        echo ":(";}